<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Binomial European Option Pricing in R | Pandamonium</title>
  <meta name="description" content="Musings of a Panda" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />

  <meta name="generator" content="Pandamonium">

  
  
  

  
</head>


<body class="post-template">

  <header class="site-head" >
    <div class="vertical">
        <div class="site-head-content inner">
            
            <h1 class="blog-title"><a href="/">Pandamonium</a></h1>
            <h2 class="blog-description"><a href="/">Musings of a Panda</a></h2>
        </div>
    </div>
</header>

  

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2015-10-26T04:48:14.000Z" itemprop="datePublished">
          2015-10-26
      </time>
    
</span>
    <h1 class="post-title">Binomial European Option Pricing in R</h1>
    <section class="post-content">
      <p>The code for this is available at <a href="https://github.com/linanqiu/binomial-european-option-r" target="_blank" rel="external">linanqiu/binomial-european-option-r</a>.</p>
<p>This post by Intel <a href="https://software.intel.com/en-us/articles/binomial-options-pricing-model-code-for-intel-xeon-phi-coprocessor" target="_blank" rel="external">https://software.intel.com/en-us/articles/binomial-options-pricing-model-code-for-intel-xeon-phi-coprocessor</a> is a surprisingly good explanation of the theoretical background of this subject and an insanely fast CPU level implementation of this.</p>
<p>My Financial Engineering class was working on Binomial European Option Pricing, and the prof insisted that we show the entire tree matrix for the intermediate steps (and not just the final price). Turns out the packages available on <a href="https://cran.r-project.org/" target="_blank" rel="external">https://cran.r-project.org/</a> don’t seem to do that. Either way, good exercise to implement this from scratch and revise for the midterms.</p>
<p>First, let’s talk about our model.</p>
<p>Let’s say time is $T$ where $T=1$ represents a year, and $T=0.25$ represents 3 months. The number of periods we simulate is $N$. Then, the amount of time represented by each period is $\Delta t = \frac{T}{N}$.</p>
<p>We assume that in each period, the stock can go up by</p>
<p>$$U = e^{\sigma * \sqrt{\Delta t}}$$</p>
<p>where $\sigma$ is the volatility, and $\Delta t$ is $\frac{T}{N}$.</p>
<p>Then, if the stock value is $S$ at period 1, it would go up to</p>
<p>$$S_U = US = e^{\sigma * \sqrt{\Delta t}}S$$ in period 2.</p>
<p>It can also go down by</p>
<p>$$D = e^{-\sigma * \sqrt{\Delta t}}$$.</p>
<p>Astute readers will recognize this as a <strong>Geometric Brownian Motion</strong> (I will probably make another post about this next time).</p>
<p>That means, say $S=10$ and $\sigma = 0.2$, $T=1$ (1 year) and $N=2$, then $U = e^{\sigma * sqrt{\Delta t}} = 1.15191$ and $D = 0.8681234$.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">period 0: 10.0</span><br><span class="line">period 1: 8.68  11.5</span><br><span class="line">period 2: 7.54  10.0  13.3</span><br></pre></td></tr></table></figure>
<p>The number directly below represents $S_D = DS$ and the number directly above represents $S_U = US$, and the second period is calculated recursively.</p>
<p>Then, we can build a stock tree!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">build_stock_tree = <span class="keyword">function</span>(S, sigma, delta_t, N) &#123;</span><br><span class="line">  tree = matrix(<span class="number">0</span>, nrow=N+<span class="number">1</span>, ncol=N+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  u = exp(sigma*sqrt(delta_t))</span><br><span class="line">  d = exp(-sigma*sqrt(delta_t))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(N+<span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:i) &#123;</span><br><span class="line">      tree[i,j] = S * u^(j-<span class="number">1</span>) * d^((i-<span class="number">1</span>)-(j-<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(tree)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To see what this gives us, let’s try it with the parameters above:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; build_stock_tree(S=10, sigma=0.2, delta_t=1/2, N=2)</span><br><span class="line">          [,1]    [,2]     [,3]</span><br><span class="line">[1,] 10.000000  0.0000  0.00000</span><br><span class="line">[2,]  8.681234 11.5191  0.00000</span><br><span class="line">[3,]  7.536383 10.0000 13.26896</span><br></pre></td></tr></table></figure>
<p>Cool! We just did what we wanted to do but way faster. In fact, we can expand the number of levels really easily. Note that when <code>N</code> changes, <code>delta_t</code> should change too. This is not too much of a problem – we’ll be calculating <code>delta_t</code> programmatically soon.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; build_stock_tree(S=<span class="number">10</span>, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, N=<span class="number">5</span>)</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br></pre></td></tr></table></figure>
<p>Now how do we get an option’s price from the underlier’s (stock’s) price? Let’s say that we have a <strong>call</strong> option. Then, we know that at termination, the value of the call option is $\max(S-X, 0)$ where $S$ here is the price of the stock at termination, and $X$ is the strike price. So say $X=10$, then in our example above, the various values of the call option would be</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.0000000 0.0000000 0.0000000 0.9356469 3.0777623 5.6394832</span><br></pre></td></tr></table></figure>
<p>But how do we advance up the option back to the price at the beginning? We call upon the powers of the <strong>q-measure</strong> where $q$ is the risk-neutral no-arbitrage probability which is independent of the actual probability of the stock going up or down. Finance textbooks tell us that</p>
<p>$$q \equiv \frac{R-D}{U-D}$$</p>
<p>where $R$ is $e^{r*\Delta t}$ where $r$ is the interest rate per annum continuously compounded. $R$ is then the discount factor. The derivation of $$q$$ will be left to another time.</p>
<p>Then, we can write a function to calculate $$q$$.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">q_prob = <span class="keyword">function</span>(r, delta_t, sigma) &#123;</span><br><span class="line">  u = exp(sigma*sqrt(delta_t))</span><br><span class="line">  d = exp(-sigma*sqrt(delta_t))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>((exp(r*delta_t) - d)/(u-d))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, we know that</p>
<p>$$C = \frac{qC_U + (1-q)C_D}{R}$$</p>
<p>where $C$ is the price of the option in a previous time period, and $C_U$ is the value of the option when the underlier went up, and $C_D$ is the value of the option when the underlier went down.</p>
<p>That means we can derive the step above the last row of the call option. Let’s say that $r = 0.1$ for <strong>10 percent interest continuously compounded a year.</strong> First we find that</p>
<p>$$R = e^{r * \Delta t} = e^{\frac{0.1}{5}} = 1.020201$$</p>
<p>Then, $q = \frac{R-D}{U-D} = 0.5904327$ using our <code>q_prob</code> function above with <code>q_prob(0.1, 1/5, 0.2)</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0.0000000 0.0000000 0.5414976 2.1568506 4.499392 0.000000</span><br><span class="line">0.0000000 0.0000000 0.0000000 0.9356469 3.077762 5.639483</span><br></pre></td></tr></table></figure>
<p>You should verify the first row using the q-measure method.</p>
<p>We can code this into a method (account for both “put” and “call”).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">value_binomial_option = <span class="keyword">function</span>(tree, sigma, delta_t, r, X, type) &#123;</span><br><span class="line">  q = q_prob(r, delta_t, sigma)</span><br><span class="line"></span><br><span class="line">  option_tree = matrix(<span class="number">0</span>, nrow=nrow(tree), ncol=ncol(tree))</span><br><span class="line">  <span class="keyword">if</span>(type == <span class="string">'put'</span>) &#123;</span><br><span class="line">    option_tree[nrow(option_tree),] = pmax(X - tree[nrow(tree),], <span class="number">0</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    option_tree[nrow(option_tree),] = pmax(tree[nrow(tree),] - X, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> (nrow(tree)-<span class="number">1</span>):<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j <span class="keyword">in</span> <span class="number">1</span>:i) &#123;</span><br><span class="line">      option_tree[i, j] = ((<span class="number">1</span>-q)*option_tree[i+<span class="number">1</span>,j] + q*option_tree[i+<span class="number">1</span>,j+<span class="number">1</span>])/exp(r*delta_t)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(option_tree)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function takes in a stock tree generated in the <code>build_stock_tree</code> function, and returns an option tree. For the previous option, it would generate</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; tree = build_stock_tree(S=<span class="number">10</span>, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, N=<span class="number">5</span>)</span><br><span class="line">&gt; value_binomial_option(tree, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, type=<span class="string">'call'</span>)</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]      [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">1.3515415</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.6365307</span> <span class="number">1.8937675</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">0.1813700</span> <span class="number">0.9740419</span> <span class="number">2.5965507</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">0.0000000</span> <span class="number">0.3133870</span> <span class="number">1.4656468</span> <span class="number">3.4698679</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.5414976</span> <span class="number">2.1568506</span> <span class="number">4.499392</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.9356469</span> <span class="number">3.077762</span> <span class="number">5.639483</span></span><br></pre></td></tr></table></figure>
<p>Now let’s put everything together and make the output a nice little list.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">binomial_option = <span class="keyword">function</span>(type, sigma, <span class="literal">T</span>, r, X, S, N) &#123;</span><br><span class="line">  q = q_prob(r=r, delta_t=<span class="literal">T</span>/N, sigma=sigma)</span><br><span class="line">  tree = build_stock_tree(S=S, sigma=sigma, delta_t=<span class="literal">T</span>/N, N=N)</span><br><span class="line">  option = value_binomial_option(tree, sigma=sigma, delta_t=<span class="literal">T</span>/N, r=r, X=X, type=type)</span><br><span class="line">  <span class="keyword">return</span>(list(q=q, stock=tree, option=option, price=option[<span class="number">1</span>,<span class="number">1</span>], delta=delta))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Usually, there’s also something that we want to compute: the $$\Delta$$ of stocks – the amount of stocks that are required to replicate the portfolio.</p>
<p>$$\Delta = \frac{C_U - C_D}{S_U - S_D}$$</p>
<p>We code this as</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delta = <span class="keyword">function</span>(binomial_option, row, col) &#123;</span><br><span class="line">  stock_tree = binomial_option$stock</span><br><span class="line">  option_tree = binomial_option$option</span><br><span class="line">  <span class="keyword">return</span>((option_tree[row+<span class="number">1</span>, col+<span class="number">1</span>] - option_tree[row+<span class="number">1</span>, col])/(stock_tree[row+<span class="number">1</span>, col+<span class="number">1</span>] - stock_tree[row+<span class="number">1</span>, col]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, the overall function becomes</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">binomial_option = <span class="keyword">function</span>(type, sigma, <span class="literal">T</span>, r, X, S, N) &#123;</span><br><span class="line">  q = q_prob(r=r, delta_t=<span class="literal">T</span>/N, sigma=sigma)</span><br><span class="line">  tree = build_stock_tree(S=S, sigma=sigma, delta_t=<span class="literal">T</span>/N, N=N)</span><br><span class="line">  option = value_binomial_option(tree, sigma=sigma, delta_t=<span class="literal">T</span>/N, r=r, X=X, type=type)</span><br><span class="line">  delta = (option[<span class="number">2</span>,<span class="number">2</span>]-option[<span class="number">2</span>,<span class="number">1</span>])/(tree[<span class="number">2</span>,<span class="number">2</span>]-tree[<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line">  <span class="keyword">return</span>(list(q=q, stock=tree, option=option, price=option[<span class="number">1</span>,<span class="number">1</span>], delta=delta))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Look how pretty the output is for our example!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; binomial_option(type=<span class="string">'call'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, S=<span class="number">10</span>, N=<span class="number">5</span>)</span><br><span class="line">$q</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5904327</span></span><br><span class="line"></span><br><span class="line">$stock</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br><span class="line"></span><br><span class="line">$option</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]      [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">1.3515415</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.6365307</span> <span class="number">1.8937675</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">0.1813700</span> <span class="number">0.9740419</span> <span class="number">2.5965507</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">0.0000000</span> <span class="number">0.3133870</span> <span class="number">1.4656468</span> <span class="number">3.4698679</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.5414976</span> <span class="number">2.1568506</span> <span class="number">4.499392</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.9356469</span> <span class="number">3.077762</span> <span class="number">5.639483</span></span><br><span class="line"></span><br><span class="line">$price</span><br><span class="line">[<span class="number">1</span>] <span class="number">1.351541</span></span><br><span class="line"></span><br><span class="line">$delta</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.7018805</span></span><br></pre></td></tr></table></figure>
<p>Let’s try the model for a put with the same parameters.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; binomial_option(type=<span class="string">'put'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, S=<span class="number">10</span>, N=<span class="number">5</span>)</span><br><span class="line">$q</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5904327</span></span><br><span class="line"></span><br><span class="line">$stock</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br><span class="line"></span><br><span class="line">$option</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]       [,<span class="number">3</span>] [,<span class="number">4</span>] [,<span class="number">5</span>] [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">0.3999157</span> <span class="number">0.0000000</span> <span class="number">0.00000000</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.7232877</span> <span class="number">0.1892841</span> <span class="number">0.00000000</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">1.2369985</span> <span class="number">0.3916873</span> <span class="number">0.05535867</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">1.9613263</span> <span class="number">0.7768750</span> <span class="number">0.13789428</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">2.8096541</span> <span class="number">1.4399698</span> <span class="number">0.34348430</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">3.6059268</span> <span class="number">2.3534319</span> <span class="number">0.85559356</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"></span><br><span class="line">$price</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.3999157</span></span><br><span class="line"></span><br><span class="line">$delta</span><br><span class="line">[<span class="number">1</span>] -<span class="number">0.2981195</span></span><br></pre></td></tr></table></figure>
<p>As a sanity check, we ensure that</p>
<ol>
<li>Price of call minus price of put (long a call, short a put) equals a forward. In other words $C - P = S + \frac{X}{e^{r}}$. In our case, $1.351541 - 0.3999157 = 10 - \frac{10}{e^{0.1}} = 0.9516258$ so that’s good!</li>
<li>$\Delta_C - \Delta_P = 1$, which again is true!</li>
</ol>
<p>Woohoo!</p>
<p>What if we want to find out how option price evolves as we increase the number of periods? Well we can do that!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">periods = seq(<span class="number">100</span>, <span class="number">120</span>)</span><br><span class="line">option_price_vary_period = <span class="keyword">function</span>(period) &#123;</span><br><span class="line">  print(period)</span><br><span class="line">  option = binomial_option(type=<span class="string">'call'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0</span>, X=<span class="number">100</span>, S=<span class="number">100</span>, N=period)</span><br><span class="line">  <span class="keyword">return</span>(option$price)</span><br><span class="line">&#125;</span><br><span class="line">values = sapply(periods, option_price_vary_period)</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">data = as.data.frame(list(periods=periods, values=values))</span><br><span class="line">plot = ggplot(data=data) + geom_line(aes(x=periods, y=values)) + labs(title=<span class="string">"Call Value"</span>, x=<span class="string">"Periods"</span>, y=<span class="string">"Value"</span>)</span><br><span class="line">plot</span><br></pre></td></tr></table></figure>
<p>However, this gets really slow as we increase the number of periods. This is rather unfortunate, since we are going at $O(N^2)$. However, we can use a slightly faster parallel implementation using the library <code>parallel</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(parallel)</span><br><span class="line">cl = makeCluster(<span class="number">8</span>)</span><br><span class="line">clusterEvalQ(cl, <span class="keyword">source</span>(<span class="string">'binomial.R'</span>))</span><br><span class="line">periods = seq(<span class="number">100</span>, <span class="number">1000</span>)</span><br><span class="line">periods = sample(periods)</span><br><span class="line">valuesPar = parSapply(cl=cl, periods, option_price_vary_period)</span><br><span class="line">data = as.data.frame(list(periods=periods, values=valuesPar))</span><br><span class="line">plot = ggplot(data=data) + geom_line(aes(x=periods, y=values, alpha=<span class="number">0.1</span>)) + geom_point((aes(x=periods, y=values))) + labs(title=<span class="string">"Call Value"</span>, x=<span class="string">"Periods"</span>, y=<span class="string">"Value"</span>)</span><br><span class="line">plot</span><br><span class="line">stopCluster(cl)</span><br></pre></td></tr></table></figure>
<p>This assumes that <code>binomial.R</code> is in the same folder. This should speed things up A LOT. Reason why I randomized periods in the 5th line is because the larger periods take WAY longer, so you’ll want to distribute that among the cores rather evenly (since <code>parSapply</code> segments the input into equal segments increasingly). This doesn’t affect the graphing at all, and if you want you can always sort the result.</p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Linan Qiu</h4>
    <p>A panda that eats bamboo and bashes keyboards.</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://linanqiu.github.io/2015/10/26/Binomial-European-Option-Pricing-in-R/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://linanqiu.github.io/2015/10/26/Binomial-European-Option-Pricing-in-R/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://linanqiu.github.io/2015/10/26/Binomial-European-Option-Pricing-in-R/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>
    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/2015/12/03/pca-irs/">
        ← Principal Component Analysis on Interest Rate Swaps
    </a>
    
    <span class="page-number">•</span>
    
    <a class="older-posts" href="/2015/10/15/Finding-Quantile-Given-Weird-Density-Function/">
        Finding Quantile Given Weird Density Function →
    </a>
    
</nav>
  <div id="comment" class="comments-area">
    <h1 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h1>

    
</div>
</main>


  
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Pandamonium</a> &copy; 2016 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>


<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-66827435-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>





</body>
</html>
