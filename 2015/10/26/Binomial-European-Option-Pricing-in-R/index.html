<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Binomial European Option Pricing in R | Pandamonium | Musings of a Panda</title>
  <meta name="author" content="Linan Qiu">
  
  <meta name="description" content="Linan&#39;s Blog">
  
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Binomial European Option Pricing in R"/>
  <meta property="og:site_name" content="Pandamonium"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Pandamonium" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div id="page" class="site">
  <div id="primary" class="content-area">

    <header id="header" class="inner"><div class="site-branding">
  <h1 class="site-title">
    <a href="/">Pandamonium</a>
  </h1>
  <p class="site-description">Musings of a Panda</p>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>

    <article id="content" class="site-content">
      <main id="main" class="site-main posts-loop" role="main">
        <article class="post article">

  
  
    <h3 class="article-title"><span>Binomial European Option Pricing in R</span></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/26/Binomial-European-Option-Pricing-in-R/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-26T04:48:14.000Z">
          2015-10-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>The code for this is available at <a href="https://github.com/linanqiu/binomial-european-option-r" target="_blank" rel="noopener">linanqiu/binomial-european-option-r</a>.</p>
<p>This post by Intel <a href="https://software.intel.com/en-us/articles/binomial-options-pricing-model-code-for-intel-xeon-phi-coprocessor" class="uri" target="_blank" rel="noopener">https://software.intel.com/en-us/articles/binomial-options-pricing-model-code-for-intel-xeon-phi-coprocessor</a> is a surprisingly good explanation of the theoretical background of this subject and an insanely fast CPU level implementation of this.</p>
<p>My Financial Engineering class was working on Binomial European Option Pricing, and the prof insisted that we show the entire tree matrix for the intermediate steps (and not just the final price). Turns out the packages available on <a href="https://cran.r-project.org/" class="uri" target="_blank" rel="noopener">https://cran.r-project.org/</a> don’t seem to do that. Either way, good exercise to implement this from scratch and revise for the midterms.</p>
<p>First, let’s talk about our model.</p>
<p>Let’s say time is <span class="math inline">\(T\)</span> where <span class="math inline">\(T=1\)</span> represents a year, and <span class="math inline">\(T=0.25\)</span> represents 3 months. The number of periods we simulate is <span class="math inline">\(N\)</span>. Then, the amount of time represented by each period is <span class="math inline">\(\Delta t = \frac{T}{N}\)</span>.</p>
<p>We assume that in each period, the stock can go up by</p>
<p><span class="math display">\[U = e^{\sigma * \sqrt{\Delta t}}\]</span></p>
<p>where <span class="math inline">\(\sigma\)</span> is the volatility, and <span class="math inline">\(\Delta t\)</span> is <span class="math inline">\(\frac{T}{N}\)</span>.</p>
<p>Then, if the stock value is <span class="math inline">\(S\)</span> at period 1, it would go up to</p>
<p><span class="math display">\[S_U = US = e^{\sigma * \sqrt{\Delta t}}S\]</span> in period 2.</p>
<p>It can also go down by</p>
<p><span class="math display">\[D = e^{-\sigma * \sqrt{\Delta t}}\]</span>.</p>
<p>Astute readers will recognize this as a <strong>Geometric Brownian Motion</strong> (I will probably make another post about this next time).</p>
<p>That means, say <span class="math inline">\(S=10\)</span> and <span class="math inline">\(\sigma = 0.2\)</span>, <span class="math inline">\(T=1\)</span> (1 year) and <span class="math inline">\(N=2\)</span>, then <span class="math inline">\(U = e^{\sigma * sqrt{\Delta t}} = 1.15191\)</span> and <span class="math inline">\(D = 0.8681234\)</span>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">period 0: 10.0</span><br><span class="line">period 1: 8.68  11.5</span><br><span class="line">period 2: 7.54  10.0  13.3</span><br></pre></td></tr></table></figure>
<p>The number directly below represents <span class="math inline">\(S_D = DS\)</span> and the number directly above represents <span class="math inline">\(S_U = US\)</span>, and the second period is calculated recursively.</p>
<p>Then, we can build a stock tree!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">build_stock_tree = <span class="keyword">function</span>(S, sigma, delta_t, N) &#123;</span><br><span class="line">  tree = matrix(<span class="number">0</span>, nrow=N+<span class="number">1</span>, ncol=N+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  u = exp(sigma*sqrt(delta_t))</span><br><span class="line">  d = exp(-sigma*sqrt(delta_t))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(N+<span class="number">1</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:i) &#123;</span><br><span class="line">      tree[i,j] = S * u^(j-<span class="number">1</span>) * d^((i-<span class="number">1</span>)-(j-<span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(tree)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To see what this gives us, let’s try it with the parameters above:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; build_stock_tree(S=10, sigma=0.2, delta_t=1/2, N=2)</span><br><span class="line">          [,1]    [,2]     [,3]</span><br><span class="line">[1,] 10.000000  0.0000  0.00000</span><br><span class="line">[2,]  8.681234 11.5191  0.00000</span><br><span class="line">[3,]  7.536383 10.0000 13.26896</span><br></pre></td></tr></table></figure>
<p>Cool! We just did what we wanted to do but way faster. In fact, we can expand the number of levels really easily. Note that when <code>N</code> changes, <code>delta_t</code> should change too. This is not too much of a problem – we’ll be calculating <code>delta_t</code> programmatically soon.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; build_stock_tree(S=<span class="number">10</span>, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, N=<span class="number">5</span>)</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br></pre></td></tr></table></figure>
<p>Now how do we get an option’s price from the underlier’s (stock’s) price? Let’s say that we have a <strong>call</strong> option. Then, we know that at termination, the value of the call option is <span class="math inline">\(\max(S-X, 0)\)</span> where <span class="math inline">\(S\)</span> here is the price of the stock at termination, and <span class="math inline">\(X\)</span> is the strike price. So say <span class="math inline">\(X=10\)</span>, then in our example above, the various values of the call option would be</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.0000000 0.0000000 0.0000000 0.9356469 3.0777623 5.6394832</span><br></pre></td></tr></table></figure>
<p>But how do we advance up the option back to the price at the beginning? We call upon the powers of the <strong>q-measure</strong> where <span class="math inline">\(q\)</span> is the risk-neutral no-arbitrage probability which is independent of the actual probability of the stock going up or down. Finance textbooks tell us that</p>
<p><span class="math display">\[q \equiv \frac{R-D}{U-D}\]</span></p>
<p>where <span class="math inline">\(R\)</span> is <span class="math inline">\(e^{r*\Delta t}\)</span> where <span class="math inline">\(r\)</span> is the interest rate per annum continuously compounded. <span class="math inline">\(R\)</span> is then the discount factor. The derivation of <span class="math display">\[q\]</span> will be left to another time.</p>
<p>Then, we can write a function to calculate <span class="math display">\[q\]</span>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">q_prob = <span class="keyword">function</span>(r, delta_t, sigma) &#123;</span><br><span class="line">  u = exp(sigma*sqrt(delta_t))</span><br><span class="line">  d = exp(-sigma*sqrt(delta_t))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>((exp(r*delta_t) - d)/(u-d))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, we know that</p>
<p><span class="math display">\[C = \frac{qC_U + (1-q)C_D}{R}\]</span></p>
<p>where <span class="math inline">\(C\)</span> is the price of the option in a previous time period, and <span class="math inline">\(C_U\)</span> is the value of the option when the underlier went up, and <span class="math inline">\(C_D\)</span> is the value of the option when the underlier went down.</p>
<p>That means we can derive the step above the last row of the call option. Let’s say that <span class="math inline">\(r = 0.1\)</span> for <strong>10 percent interest continuously compounded a year.</strong> First we find that</p>
<p><span class="math display">\[R = e^{r * \Delta t} = e^{\frac{0.1}{5}} = 1.020201\]</span></p>
<p>Then, <span class="math inline">\(q = \frac{R-D}{U-D} = 0.5904327\)</span> using our <code>q_prob</code> function above with <code>q_prob(0.1, 1/5, 0.2)</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0.0000000 0.0000000 0.5414976 2.1568506 4.499392 0.000000</span><br><span class="line">0.0000000 0.0000000 0.0000000 0.9356469 3.077762 5.639483</span><br></pre></td></tr></table></figure>
<p>You should verify the first row using the q-measure method.</p>
<p>We can code this into a method (account for both “put” and “call”).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">value_binomial_option = <span class="keyword">function</span>(tree, sigma, delta_t, r, X, type) &#123;</span><br><span class="line">  q = q_prob(r, delta_t, sigma)</span><br><span class="line"></span><br><span class="line">  option_tree = matrix(<span class="number">0</span>, nrow=nrow(tree), ncol=ncol(tree))</span><br><span class="line">  <span class="keyword">if</span>(type == <span class="string">'put'</span>) &#123;</span><br><span class="line">    option_tree[nrow(option_tree),] = pmax(X - tree[nrow(tree),], <span class="number">0</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    option_tree[nrow(option_tree),] = pmax(tree[nrow(tree),] - X, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> (nrow(tree)-<span class="number">1</span>):<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j <span class="keyword">in</span> <span class="number">1</span>:i) &#123;</span><br><span class="line">      option_tree[i, j] = ((<span class="number">1</span>-q)*option_tree[i+<span class="number">1</span>,j] + q*option_tree[i+<span class="number">1</span>,j+<span class="number">1</span>])/exp(r*delta_t)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>(option_tree)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This function takes in a stock tree generated in the <code>build_stock_tree</code> function, and returns an option tree. For the previous option, it would generate</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; tree = build_stock_tree(S=<span class="number">10</span>, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, N=<span class="number">5</span>)</span><br><span class="line">&gt; value_binomial_option(tree, sigma=<span class="number">0.2</span>, delta_t=<span class="number">1</span>/<span class="number">5</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, type=<span class="string">'call'</span>)</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]      [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">1.3515415</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.6365307</span> <span class="number">1.8937675</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">0.1813700</span> <span class="number">0.9740419</span> <span class="number">2.5965507</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">0.0000000</span> <span class="number">0.3133870</span> <span class="number">1.4656468</span> <span class="number">3.4698679</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.5414976</span> <span class="number">2.1568506</span> <span class="number">4.499392</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.9356469</span> <span class="number">3.077762</span> <span class="number">5.639483</span></span><br></pre></td></tr></table></figure>
<p>Now let’s put everything together and make the output a nice little list.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">binomial_option = <span class="keyword">function</span>(type, sigma, <span class="literal">T</span>, r, X, S, N) &#123;</span><br><span class="line">  q = q_prob(r=r, delta_t=<span class="literal">T</span>/N, sigma=sigma)</span><br><span class="line">  tree = build_stock_tree(S=S, sigma=sigma, delta_t=<span class="literal">T</span>/N, N=N)</span><br><span class="line">  option = value_binomial_option(tree, sigma=sigma, delta_t=<span class="literal">T</span>/N, r=r, X=X, type=type)</span><br><span class="line">  <span class="keyword">return</span>(list(q=q, stock=tree, option=option, price=option[<span class="number">1</span>,<span class="number">1</span>], delta=delta))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Usually, there’s also something that we want to compute: the <span class="math display">\[\Delta\]</span> of stocks – the amount of stocks that are required to replicate the portfolio.</p>
<p><span class="math display">\[\Delta = \frac{C_U - C_D}{S_U - S_D}\]</span></p>
<p>We code this as</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delta = <span class="keyword">function</span>(binomial_option, row, col) &#123;</span><br><span class="line">  stock_tree = binomial_option$stock</span><br><span class="line">  option_tree = binomial_option$option</span><br><span class="line">  <span class="keyword">return</span>((option_tree[row+<span class="number">1</span>, col+<span class="number">1</span>] - option_tree[row+<span class="number">1</span>, col])/(stock_tree[row+<span class="number">1</span>, col+<span class="number">1</span>] - stock_tree[row+<span class="number">1</span>, col]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then, the overall function becomes</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">binomial_option = <span class="keyword">function</span>(type, sigma, <span class="literal">T</span>, r, X, S, N) &#123;</span><br><span class="line">  q = q_prob(r=r, delta_t=<span class="literal">T</span>/N, sigma=sigma)</span><br><span class="line">  tree = build_stock_tree(S=S, sigma=sigma, delta_t=<span class="literal">T</span>/N, N=N)</span><br><span class="line">  option = value_binomial_option(tree, sigma=sigma, delta_t=<span class="literal">T</span>/N, r=r, X=X, type=type)</span><br><span class="line">  delta = (option[<span class="number">2</span>,<span class="number">2</span>]-option[<span class="number">2</span>,<span class="number">1</span>])/(tree[<span class="number">2</span>,<span class="number">2</span>]-tree[<span class="number">2</span>,<span class="number">1</span>])</span><br><span class="line">  <span class="keyword">return</span>(list(q=q, stock=tree, option=option, price=option[<span class="number">1</span>,<span class="number">1</span>], delta=delta))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Look how pretty the output is for our example!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; binomial_option(type=<span class="string">'call'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, S=<span class="number">10</span>, N=<span class="number">5</span>)</span><br><span class="line">$q</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5904327</span></span><br><span class="line"></span><br><span class="line">$stock</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br><span class="line"></span><br><span class="line">$option</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]      [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">1.3515415</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.6365307</span> <span class="number">1.8937675</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">0.1813700</span> <span class="number">0.9740419</span> <span class="number">2.5965507</span> <span class="number">0.0000000</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">0.0000000</span> <span class="number">0.3133870</span> <span class="number">1.4656468</span> <span class="number">3.4698679</span> <span class="number">0.000000</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.5414976</span> <span class="number">2.1568506</span> <span class="number">4.499392</span> <span class="number">0.000000</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.0000000</span> <span class="number">0.9356469</span> <span class="number">3.077762</span> <span class="number">5.639483</span></span><br><span class="line"></span><br><span class="line">$price</span><br><span class="line">[<span class="number">1</span>] <span class="number">1.351541</span></span><br><span class="line"></span><br><span class="line">$delta</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.7018805</span></span><br></pre></td></tr></table></figure>
<p>Let’s try the model for a put with the same parameters.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt; binomial_option(type=<span class="string">'put'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0.1</span>, X=<span class="number">10</span>, S=<span class="number">10</span>, N=<span class="number">5</span>)</span><br><span class="line">$q</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5904327</span></span><br><span class="line"></span><br><span class="line">$stock</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]      [,<span class="number">3</span>]     [,<span class="number">4</span>]     [,<span class="number">5</span>]     [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">10.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">2</span>,]  <span class="number">9.144406</span> <span class="number">10.935647</span>  <span class="number">0.000000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">3</span>,]  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.958837</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">4</span>,]  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.935647</span> <span class="number">13.07776</span>  <span class="number">0.00000</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">5</span>,]  <span class="number">6.992333</span>  <span class="number">8.362017</span> <span class="number">10.000000</span> <span class="number">11.95884</span> <span class="number">14.30138</span>  <span class="number">0.00000</span></span><br><span class="line">[<span class="number">6</span>,]  <span class="number">6.394073</span>  <span class="number">7.646568</span>  <span class="number">9.144406</span> <span class="number">10.93565</span> <span class="number">13.07776</span> <span class="number">15.63948</span></span><br><span class="line"></span><br><span class="line">$option</span><br><span class="line">          [,<span class="number">1</span>]      [,<span class="number">2</span>]       [,<span class="number">3</span>] [,<span class="number">4</span>] [,<span class="number">5</span>] [,<span class="number">6</span>]</span><br><span class="line">[<span class="number">1</span>,] <span class="number">0.3999157</span> <span class="number">0.0000000</span> <span class="number">0.00000000</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">2</span>,] <span class="number">0.7232877</span> <span class="number">0.1892841</span> <span class="number">0.00000000</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">3</span>,] <span class="number">1.2369985</span> <span class="number">0.3916873</span> <span class="number">0.05535867</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">4</span>,] <span class="number">1.9613263</span> <span class="number">0.7768750</span> <span class="number">0.13789428</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">5</span>,] <span class="number">2.8096541</span> <span class="number">1.4399698</span> <span class="number">0.34348430</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line">[<span class="number">6</span>,] <span class="number">3.6059268</span> <span class="number">2.3534319</span> <span class="number">0.85559356</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">0</span></span><br><span class="line"></span><br><span class="line">$price</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.3999157</span></span><br><span class="line"></span><br><span class="line">$delta</span><br><span class="line">[<span class="number">1</span>] -<span class="number">0.2981195</span></span><br></pre></td></tr></table></figure>
<p>As a sanity check, we ensure that</p>
<ol style="list-style-type: decimal">
<li>Price of call minus price of put (long a call, short a put) equals a forward. In other words <span class="math inline">\(C - P = S + \frac{X}{e^{r}}\)</span>. In our case, <span class="math inline">\(1.351541 - 0.3999157 = 10 - \frac{10}{e^{0.1}} = 0.9516258\)</span> so that’s good!</li>
<li><span class="math inline">\(\Delta_C - \Delta_P = 1\)</span>, which again is true!</li>
</ol>
<p>Woohoo!</p>
<p>What if we want to find out how option price evolves as we increase the number of periods? Well we can do that!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">periods = seq(<span class="number">100</span>, <span class="number">120</span>)</span><br><span class="line">option_price_vary_period = <span class="keyword">function</span>(period) &#123;</span><br><span class="line">  print(period)</span><br><span class="line">  option = binomial_option(type=<span class="string">'call'</span>, sigma=<span class="number">0.2</span>, <span class="literal">T</span>=<span class="number">1</span>, r=<span class="number">0</span>, X=<span class="number">100</span>, S=<span class="number">100</span>, N=period)</span><br><span class="line">  <span class="keyword">return</span>(option$price)</span><br><span class="line">&#125;</span><br><span class="line">values = sapply(periods, option_price_vary_period)</span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">data = as.data.frame(list(periods=periods, values=values))</span><br><span class="line">plot = ggplot(data=data) + geom_line(aes(x=periods, y=values)) + labs(title=<span class="string">"Call Value"</span>, x=<span class="string">"Periods"</span>, y=<span class="string">"Value"</span>)</span><br><span class="line">plot</span><br></pre></td></tr></table></figure>
<p>However, this gets really slow as we increase the number of periods. This is rather unfortunate, since we are going at <span class="math inline">\(O(N^2)\)</span>. However, we can use a slightly faster parallel implementation using the library <code>parallel</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(parallel)</span><br><span class="line">cl = makeCluster(<span class="number">8</span>)</span><br><span class="line">clusterEvalQ(cl, <span class="keyword">source</span>(<span class="string">'binomial.R'</span>))</span><br><span class="line">periods = seq(<span class="number">100</span>, <span class="number">1000</span>)</span><br><span class="line">periods = sample(periods)</span><br><span class="line">valuesPar = parSapply(cl=cl, periods, option_price_vary_period)</span><br><span class="line">data = as.data.frame(list(periods=periods, values=valuesPar))</span><br><span class="line">plot = ggplot(data=data) + geom_line(aes(x=periods, y=values, alpha=<span class="number">0.1</span>)) + geom_point((aes(x=periods, y=values))) + labs(title=<span class="string">"Call Value"</span>, x=<span class="string">"Periods"</span>, y=<span class="string">"Value"</span>)</span><br><span class="line">plot</span><br><span class="line">stopCluster(cl)</span><br></pre></td></tr></table></figure>
<p>This assumes that <code>binomial.R</code> is in the same folder. This should speed things up A LOT. Reason why I randomized periods in the 5th line is because the larger periods take WAY longer, so you’ll want to distribute that among the cores rather evenly (since <code>parSapply</code> segments the input into equal segments increasingly). This doesn’t affect the graphing at all, and if you want you can always sort the result.</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
          
        </div>
        
    </footer>
  </div>
</article>

  



      </main>
    </article>

    <footer id="colophon" class="site-footer" role="contentinfo"><p class="site-info">
  Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
  Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
  </br>
  
  &copy; 2018 Linan Qiu
  
</p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66827435-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</body>
</html>
