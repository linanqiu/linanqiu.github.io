<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Using CircleCI to Grade Java Assignments | Pandamonium | Musings of a Panda</title>
  <meta name="author" content="Linan Qiu">
  
  <meta name="description" content="Linan&#39;s Blog">
  
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Using CircleCI to Grade Java Assignments"/>
  <meta property="og:site_name" content="Pandamonium"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Pandamonium" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div id="page" class="site">
  <div id="primary" class="content-area">

    <header id="header" class="inner"><div class="site-branding">
  <h1 class="site-title">
    <a href="/">Pandamonium</a>
  </h1>
  <p class="site-description">Musings of a Panda</p>
</div>
<nav id="site-navigation" class="main-navigation" role="navigation">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
</nav></header>

    <article id="content" class="site-content">
      <main id="main" class="site-main posts-loop" role="main">
        <article class="post article">

  
  
    <h3 class="article-title"><span>Using CircleCI to Grade Java Assignments</span></h3>
  


  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/08/21/Using-CircleCI-to-Grade-Java-Assignments/" rel="bookmark">
        <time class="entry-date published" datetime="2015-08-21T06:51:24.000Z">
          2015-08-21
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>It’s ridiculous we don’t have a proper solution that uses Continuous Integration (CI) to grade homeworks hosted on GitHub.</p>
<p>CI, in short, is just a server that runs unit tests on your code every time you commit it. That means instead of you having to run unit tests before your commit your code (or manually run them after you commit them), a little robot checks your code against your unit tests every time you commit the code. That little robot never gets tired, doesn’t need to be fed. In short, these little robots are way better than human Teaching Assistants (TAs) (who in contrast, need to be fed pizza).</p>
<p>Given that I’ll be Head TAing a class with nearly 300 students this fall, I can’t afford enough pizzas to keep my team running. Or maybe I can, but I prefer not to. So why not get CI servers to grade homeworks? That requires two things:</p>
<ol style="list-style-type: decimal">
<li>Getting students on GitHub (and submitting homeworks via GitHub)</li>
<li>Grading those homeworks on GitHub</li>
</ol>
<p>I’ll talk about (1) in a later post when I have the system fully set up, but basically it involves playing nice to GitHub and getting a team with lots and lots of private repositories. Then you give each student one private repository (so that they can’t copy. But then again, since they’re all on GitHub, it should be easy to implement a cheat check. That’s for next time).</p>
<h2 id="homework-assignment">Homework Assignment</h2>
<p>Let’s say that the student is supposed to write an assignment like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FibonacciRecursive</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        System.out.println(fibonacci(<span class="number">5</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="comment">// this is the method that student codes up</span></div><div class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This happens in a file called <code>FibonacciRecursive.java</code>. (Wow surprise).</p>
<p>This is usually one of the first assignments in a data structures class or a last assignment in an intro programming class. Whatever it is, we can be sure of the following:</p>
<ol style="list-style-type: decimal">
<li>You do not want to introduce unnecessary files into the homework package that the student works with. This confuses a student easily, and no good packaging software exists for Java which is as simple and intuitive as Grunt or NPM in JavaScript. You probably don’t want to use Maven or Ant.</li>
<li>You probably want to avoid unit tests, since they make it difficult for you to score the entire assignment, run asynchronously, and produce rather ugly output.</li>
</ol>
<p>Given those two limitations, you are set back by quite a bit, since most CI servers only run well on those systems. Give it Java with Maven and CircleCI (one of the larger CI services out there that provide free CI) will work like magic. However, give it non standard stuff and it coughs blood. Unfortunately, that bloody puddle is what we have to work with.</p>
<h2 id="setting-up-circleci">Setting up CircleCI</h2>
<p>(Side note: I chose CircleCI not TravisCI because Circle allows for private repositories while Travis insists on public).</p>
<p>Without a single unit test command, we have to be a little hacky with CircleCI. Now here’s how CircleCI runs in a nutshell:</p>
<ol style="list-style-type: decimal">
<li>CircleCI reads off <code>circle.yml</code> in your repository. If it finds that file, it follows the instructions in that file. Otherwise, it tries to infer your environment (be it some Ruby thingum, Maven for Java, or Grunt for JS).</li>
<li>It runs the commands in <code>circle.yml</code> or the inferred commands.</li>
<li>Specifically, in the unit test portion, it runs every command in the unit test portion. If all of them produces an exit code of 0 (that means everything’s good), the unit tests pass. If any of them produce a non-0 exit code, unit tests fail, you get an error.</li>
<li>The results of these get emailed to you.</li>
</ol>
<p>That sounds cool right? So let’s start appropriating that system for homework grading.</p>
<h2 id="game-plan">Game Plan</h2>
<p>Your directory will end up containing</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- FibonacciRecursive.java</div><div class="line">- Grader.java</div><div class="line">- build.sh</div><div class="line">- circle.yml</div></pre></td></tr></table></figure>
<p>Here’s how everything works:</p>
<ol style="list-style-type: decimal">
<li>CircleCI reads <code>circle.yml</code> which tells the server to run <code>build.sh</code> instead of running standard unit tests</li>
<li><code>build.sh</code> does the following
<ol style="list-style-type: decimal">
<li>It tries to compile <code>FibonacciRecursive.java</code> and <code>Grader.java</code></li>
<li>It runs Grader (now compiled as a class). Grader runs a series of tests on FibonacciRecursive, printing out the score that the student receives along each step. Depending on the score, Grader returns with an exit code of either 0 or 1.</li>
</ol></li>
<li><code>build.sh</code> returns whatever exit code Grader returns.</li>
<li>CircleCI consumes that exit code.</li>
</ol>
<p>And this is how we’ll abuse CircleCI to grade homeworks.</p>
<h2 id="overriding-circle.yml">Overriding <code>circle.yml</code></h2>
<p>We know that we have to override <code>circle.yml</code> to not try and run Maven / Ant / freeze up and die when we run our custom Java stuff. What’s simpler than making it run a <code>.sh</code> script?</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## Customize the test machine</span></div><div class="line"><span class="attr">machine:</span></div><div class="line">  <span class="comment"># Version of java to use</span></div><div class="line"><span class="attr">  java:</span></div><div class="line"><span class="attr">    version:</span> <span class="string">oraclejdk8</span></div><div class="line"></div><div class="line"><span class="comment">## Customize test commands</span></div><div class="line"><span class="attr">test:</span></div><div class="line"><span class="attr">  override:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">sh</span> <span class="string">build.sh</span></div></pre></td></tr></table></figure>
<p>That’s all that should go into your <code>circle.yml</code>.</p>
<h2 id="creating-build.sh">Creating <code>build.sh</code></h2>
<p>Now your <code>build.sh</code> should just compile every <code>.java</code> file in your directory and run Grader. So that’s exactly what it does:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">javac *.java</div><div class="line">java Grader</div><div class="line"><span class="built_in">exit</span></div></pre></td></tr></table></figure>
<h2 id="creating-a-grader-tool-in-java">Creating a Grader Tool in Java</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Grader</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> score = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> scoreMax = <span class="number">50</span>;</div><div class="line"></div><div class="line">        <span class="comment">// Fibonacci</span></div><div class="line">        <span class="comment">// Test 0</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">0</span>) == <span class="number">0</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 1 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 1</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">1</span>) == <span class="number">1</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 2 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 5</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">5</span>) == <span class="number">5</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 3 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 10</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">10</span>) == <span class="number">55</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 4 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test -1</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(-<span class="number">1</span>) == <span class="number">1</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 5 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (score != scoreMax) &#123;</div><div class="line">            System.out.println(<span class="string">"Score: "</span> + score + <span class="string">"/"</span> + scoreMax);</div><div class="line">            System.exit(<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            System.out.println(<span class="string">"Score: "</span> + score + <span class="string">"/"</span> + scoreMax);</div><div class="line">            System.exit(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This should be rather self explanatory – you’re basically making a series of “assertions”, but tabulating scores at the same time.</p>
<h2 id="pushing-to-github">Pushing to GitHub</h2>
<p>We push all this code to a GitHub repository:</p>
<p><a href="https://github.com/linanqiu/circle-ci-java-assignment-grading" class="uri" target="_blank" rel="external">https://github.com/linanqiu/circle-ci-java-assignment-grading</a></p>
<h2 id="setting-up-circleci-1">Setting up CircleCI</h2>
<p>Add your repository on CircleCI after you’ve set up an account.</p>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci1.png">

</div>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci2.png">

</div>
<p>You’ll see that the build has started.</p>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci3.png">

</div>
<p>And you should get the results of <code>Grader.java</code> being run on <code>FibonacciRecursive.java</code> as a result of <code>build.sh</code> being run as told by <code>circle.yml</code> (Phew)</p>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci4.png">

</div>
<h2 id="grade-on-commit">Grade On Commit</h2>
<p>It shows that we’ve failed the assignment and didn’t get full marks. Well obviously, since we made <code>Test 5</code> in the Grader an errorneous test. It should be producing 0 instead of 1. Let’s change that line:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Grader</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> score = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> scoreMax = <span class="number">50</span>;</div><div class="line"></div><div class="line">        <span class="comment">// Fibonacci</span></div><div class="line">        <span class="comment">// Test 0</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">0</span>) == <span class="number">0</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 1 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 1</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">1</span>) == <span class="number">1</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 2 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 5</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">5</span>) == <span class="number">5</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 3 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test 10</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(<span class="number">10</span>) == <span class="number">55</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 4 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Test -1</span></div><div class="line">        <span class="comment">// Modified</span></div><div class="line">        <span class="keyword">if</span> (FibonacciRecursive.fibonacci(-<span class="number">1</span>) == <span class="number">0</span>) &#123;</div><div class="line">            System.out.println(<span class="string">"Test 5 Passed +10"</span>);</div><div class="line">            score += <span class="number">10</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (score != scoreMax) &#123;</div><div class="line">            System.out.println(<span class="string">"Score: "</span> + score + <span class="string">"/"</span> + scoreMax);</div><div class="line">            System.exit(<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            System.out.println(<span class="string">"Score: "</span> + score + <span class="string">"/"</span> + scoreMax);</div><div class="line">            System.exit(<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We make this modification, and submit. We see that CircleCI has already seen the new commit and started building it:</p>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci5.png">

</div>
<p>Seems like the problem has been fixed! And this happened without us intervening (and no pizzas involved).</p>
<div class="figure">
<img src="/images/Using-CircleCI-to-Grade-Java-Assignments/circleci6.png">

</div>
<p>Isn’t this awesome? Even awesome-er, CircleCI has a great API. That means you can use this to create a live scoreboard for your students / email notifications every time they submit code.</p>

      
    </div>
    <footer class="article-footer">
        <div class="article-meta pull-left">
          
          
        </div>
        
    </footer>
  </div>
</article>

  



      </main>
    </article>

    <footer id="colophon" class="site-footer" role="contentinfo"><p class="site-info">
  Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
  Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
  </br>
  
  &copy; 2018 Linan Qiu
  
</p>
</footer>
    
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66827435-1', 'auto');
    ga('send', 'pageview');

</script>

  </div>
</div>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</body>
</html>
